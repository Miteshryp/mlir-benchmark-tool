1. Use the torch.fx to convert to MLIR. Basically we can convert to fx graph or MLIR so it makes more sense to conver to MLIR
use : python model.py

2. Now we have the mode in MLIR format. The first step now is to clean and canonicalize the model.


mlir-opt alexnet_linalg.mlir \
  --canonicalize --cse \
  -o step1.mlir



3. We can now bufferize tensors -> memrefs (need to bufferize before lowering linalg->loops)

mlir-opt step1.mlir \
  --one-shot-bufferize="bufferize-function-boundaries" \
  -o step2.mlir

4. Now lower linalg -> loops and scf -> cf (control flow)

mlir-opt step2.mlir \
  --convert-linalg-to-loops \
  --convert-scf-to-cf \
  -o step3.mlir

5. At this stage we have to lower linalg -> loops and scf -> cf (control flow)

mlir-opt step2.mlir \
  --convert-linalg-to-loops \
  --convert-scf-to-cf \
  -o step3.mlir


6. This can be our last step and here we lower memref -> llvm dialect (The whole pipeline is converting Affine, Func, Arith] -> --lower-affine [Affine -> SCF + Arith] -> {--finalize-memref-to-llvm, --convert-arith-to-llvm, --convert-func-to-llvm, --convert-cf-to-llvm} [MemRef, Arith, Func, CF -> LLVM Dialect] -> reconcile-unrealized-casts [Cleanup] -> alexnet_llvm_dialect.mlir [Pure LLVM Dialect] 

mlir-opt step3.mlir \
 --lower-affine \
 --expand-strided-metadata \
 --finalize-memref-to-llvm \
 --convert-arith-to-llvm \
 --convert-func-to-llvm \
 --convert-cf-to-llvm \
 --reconcile-unrealized-casts \
 -o alexnet_llvm_dialect.mlir


7. translate MLIR LLVM dialect -> LLVM IR (.ll)
mlir-translate --mlir-to-llvmir alexnet_llvm_dialect.mlir > alexnet.ll





## FINAL PASS

torch-mlir-opt \
  -pass-pipeline="builtin.module(torch-backend-to-linalg-on-tensors-backend-pipeline)" \
  .mlir > lower.mlir


mlir-opt alexnet_linalg.mlir \
  --canonicalize --cse \
 --one-shot-bufferize="bufferize-function-boundaries" \
  --convert-linalg-to-loops \
  --convert-scf-to-cf \
--lower-affine \
 --expand-strided-metadata \
 --finalize-memref-to-llvm \
 --convert-arith-to-llvm \
 --convert-func-to-llvm \
 --convert-cf-to-llvm \
 --reconcile-unrealized-casts \
 -o llvm_lower.mlir





























qemu-riscv64 --version    Is also installed to emulate the riscV
 
